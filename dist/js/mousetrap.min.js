(function(J,E,S){function H(C,B,A){C.addEventListener?C.addEventListener(B,A,!1):C.attachEvent("on"+B,A)}function Q(B){if("keypress"==B.type){var A=String.fromCharCode(B.which);B.shiftKey||(A=A.toLowerCase());return A}return O[B.which]?O[B.which]:G[B.which]?G[B.which]:String.fromCharCode(B.which).toLowerCase()}function N(B){var A=[];B.shiftKey&&A.push("shift");B.altKey&&A.push("alt");B.ctrlKey&&A.push("ctrl");B.metaKey&&A.push("meta");return A}function I(A){return"shift"==A||"ctrl"==A||"alt"==A||"meta"==A}function R(V,T){var A,U,B,C=[];A=V;"+"===A?A=["+"]:(A=A.replace(/\+{2}/g,"+plus"),A=A.split("+"));for(B=0;B<A.length;++B){U=A[B],P[U]&&(U=P[U]),T&&"keypress"!=T&&L[U]&&(U=L[U],C.push("shift")),I(U)&&C.push(U)}A=U;B=T;if(!B){if(!M){M={};for(var D in O){95<D&&112>D||O.hasOwnProperty(D)&&(M[O[D]]=D)}}B=M[A]?"keydown":"keypress"}"keypress"==B&&C.length&&(B="keydown");return{key:U,modifiers:C,action:B}}function K(B,A){return B===E?!1:B===A?!0:K(B.parentNode,A)}function F(Z){function Y(g){g=g||{};var e=!1,d;for(d in C){g[d]?e=!0:C[d]=0}e||(D=!1)}function V(t,r,o,u,s,j){var v,d,p=[],q=o.type;if(!f._callbacks[t]){return[]}"keyup"==q&&I(t)&&(r=[t]);for(v=0;v<f._callbacks[t].length;++v){if(d=f._callbacks[t][v],(u||!d.seq||C[d.seq]==d.level)&&q==d.action){var i;(i="keypress"==q&&!o.metaKey&&!o.ctrlKey)||(i=d.modifiers,i=r.sort().join(",")===i.sort().join(","));i&&(i=u&&d.seq==u&&d.level==j,(!u&&d.combo==s||i)&&f._callbacks[t].splice(v,1),p.push(d))}}return p}function c(g,e,d,h){f.stopCallback(e,e.target||e.srcElement,d,h)||!1!==g(e,d)||(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation?e.stopPropagation():e.cancelBubble=!0)}function A(e){"number"!==typeof e.which&&(e.which=e.keyCode);var d=Q(e);d&&("keyup"==e.type&&T===d?T=!1:f.handleKey(d,N(e),e))}function W(l,k,j,m){function b(a){return function(){D=a;++C[l];clearTimeout(U);U=setTimeout(Y,1000)}}function i(a){c(j,a,l);"keyup"!==m&&(T=Q(a));setTimeout(Y,10)}for(var o=C[l]=0;o<k.length;++o){var g=o+1===k.length?i:b(m||R(k[o+1]).action);X(k[o],g,m,l,o)}}function X(k,i,j,l,h){f._directMap[k+":"+j]=i;k=k.replace(/\s+/g," ");var d=k.split(" ");1<d.length?W(k,d,i,j):(j=R(k,j),f._callbacks[j.key]=f._callbacks[j.key]||[],V(j.key,j.modifiers,{type:j.action},l,k,h),f._callbacks[j.key][l?"unshift":"push"]({callback:i,modifiers:j.modifiers,action:j.action,seq:l,level:h,combo:k}))}var f=this;Z=Z||E;if(!(f instanceof F)){return new F(Z)}f.target=Z;f._callbacks={};f._directMap={};var C={},U,T=!1,B=!1,D=!1;f._handleKey=function(m,j,h){var n=V(m,j,h),g;j={};var b=0,i=!1;for(g=0;g<n.length;++g){n[g].seq&&(b=Math.max(b,n[g].level))}for(g=0;g<n.length;++g){n[g].seq?n[g].level==b&&(i=!0,j[n[g].seq]=1,c(n[g].callback,h,n[g].combo,n[g].seq)):i||c(n[g].callback,h,n[g].combo)}n="keypress"==h.type&&B;h.type!=D||I(m)||n||Y(j);B=i&&"keydown"==h.type};f._bindMultiple=function(i,g,h){for(var e=0;e<i.length;++e){X(i[e],g,h)}};H(Z,"keypress",A);H(Z,"keydown",A);H(Z,"keyup",A)}var O={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},G={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},L={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},P={option:"alt",command:"meta","return":"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},M;for(S=1;20>S;++S){O[111+S]="f"+S}for(S=0;9>=S;++S){O[S+96]=S}F.prototype.bind=function(C,A,B){C=C instanceof Array?C:[C];this._bindMultiple.call(this,C,A,B);return this};F.prototype.unbind=function(B,A){return this.bind.call(this,B,function(){},A)};F.prototype.trigger=function(B,A){if(this._directMap[B+":"+A]){this._directMap[B+":"+A]({},B)}return this};F.prototype.reset=function(){this._callbacks={};this._directMap={};return this};F.prototype.stopCallback=function(B,A){return -1<(" "+A.className+" ").indexOf(" mousetrap ")||K(A,this.target)?!1:"INPUT"==A.tagName||"SELECT"==A.tagName||"TEXTAREA"==A.tagName||A.isContentEditable};F.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)};F.init=function(){var B=F(E),A;for(A in B){"_"!==A.charAt(0)&&(F[A]=function(C){return function(){return B[C].apply(B,arguments)}}(A))}};F.init();J.Mousetrap=F;"undefined"!==typeof module&&module.exports&&(module.exports=F);"function"===typeof define&&define.amd&&define(function(){return F})})(window,document);