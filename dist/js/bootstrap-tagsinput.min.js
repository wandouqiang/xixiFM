!function(F){function D(K,L){this.itemsArray=[],this.$element=F(K),this.$element.hide(),this.isSelect="SELECT"===K.tagName,this.multiple=this.isSelect&&K.hasAttribute("multiple"),this.objectItems=L&&L.itemValue,this.placeholderText=K.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=F('<div class="bootstrap-tagsinput"></div>'),this.$input=F('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.after(this.$container);var J=(this.inputSize<3?3:this.inputSize)+"em";this.$input.get(0).style.cssText="width: "+J+" !important;",this.build(L)}function E(L,J){if("function"!=typeof L[J]){var K=L[J];L[J]=function(M){return M[K]}}}function I(L,J){if("function"!=typeof L[J]){var K=L[J];L[J]=function(){return K}}}function A(J){return J?C.text(J).html():""}function G(L){var J=0;if(document.selection){L.focus();var K=document.selection.createRange();K.moveStart("character",-L.value.length),J=K.text.length}else{(L.selectionStart||"0"==L.selectionStart)&&(J=L.selectionStart)}return J}function H(K,L){var J=!1;return F.each(L,function(P,O){if("number"==typeof O&&K.which===O){return J=!0,!1}if(K.which===O.which){var N=!O.hasOwnProperty("altKey")||K.altKey===O.altKey,Q=!O.hasOwnProperty("shiftKey")||K.shiftKey===O.shiftKey,M=!O.hasOwnProperty("ctrlKey")||K.ctrlKey===O.ctrlKey;if(N&&Q&&M){return J=!0,!1}}}),J}var B={tagClass:function(){return"label label-info"},itemValue:function(J){return J?J.toString():J},itemText:function(J){return this.itemValue(J)},freeInput:!0,addOnBlur:!0,maxTags:void 0,maxChars:void 0,confirmKeys:[13,44],onTagExists:function(K,J){J.hide().fadeIn()},trimValue:!1,allowDuplicates:!1};D.prototype={constructor:D,add:function(R,S){var V=this;if(!(V.options.maxTags&&V.itemsArray.length>=V.options.maxTags||R!==!1&&!R)){if("string"==typeof R&&V.options.trimValue&&(R=F.trim(R)),"object"==typeof R&&!V.objectItems){throw"Can't add objects when itemValue option is not set"}if(!R.toString().match(/^\s*$/)){if(V.isSelect&&!V.multiple&&V.itemsArray.length>0&&V.remove(V.itemsArray[0]),"string"==typeof R&&"INPUT"===this.$element[0].tagName){var T=R.split(",");if(T.length>1){for(var U=0;U<T.length;U++){this.add(T[U],!0)}return void (S||V.pushVal())}}var L=V.options.itemValue(R),M=V.options.itemText(R),J=V.options.tagClass(R),K=F.grep(V.itemsArray,function(W){return V.options.itemValue(W)===L})[0];if(!K||V.options.allowDuplicates){if(!(V.items().toString().length+R.length+1>V.options.maxInputLength)){var P=F.Event("beforeItemAdd",{item:R,cancel:!1});if(V.$element.trigger(P),!P.cancel){V.itemsArray.push(R);var Q=F('<span class="tag '+A(J)+'">'+A(M)+'<span data-role="remove"></span></span>');if(Q.data("item",R),V.findInputWrapper().before(Q),Q.after(" "),V.isSelect&&!F('option[value="'+encodeURIComponent(L)+'"]',V.$element)[0]){var N=F("<option selected>"+A(M)+"</option>");N.data("item",R),N.attr("value",L),V.$element.append(N)}S||V.pushVal(),(V.options.maxTags===V.itemsArray.length||V.items().toString().length===V.options.maxInputLength)&&V.$container.addClass("bootstrap-tagsinput-max"),V.$element.trigger(F.Event("itemAdded",{item:R}))}}}else{if(V.options.onTagExists){var O=F(".tag",V.$container).filter(function(){return F(this).data("item")===K});V.options.onTagExists(R,O)}}}}},remove:function(L,M){var J=this;if(J.objectItems&&(L="object"==typeof L?F.grep(J.itemsArray,function(N){return J.options.itemValue(N)==J.options.itemValue(L)}):F.grep(J.itemsArray,function(N){return J.options.itemValue(N)==L}),L=L[L.length-1]),L){var K=F.Event("beforeItemRemove",{item:L,cancel:!1});if(J.$element.trigger(K),K.cancel){return}F(".tag",J.$container).filter(function(){return F(this).data("item")===L}).remove(),F("option",J.$element).filter(function(){return F(this).data("item")===L}).remove(),-1!==F.inArray(L,J.itemsArray)&&J.itemsArray.splice(F.inArray(L,J.itemsArray),1)}M||J.pushVal(),J.options.maxTags>J.itemsArray.length&&J.$container.removeClass("bootstrap-tagsinput-max"),J.$element.trigger(F.Event("itemRemoved",{item:L}))},removeAll:function(){var J=this;for(F(".tag",J.$container).remove(),F("option",J.$element).remove();J.itemsArray.length>0;){J.itemsArray.pop()}J.pushVal()},refresh:function(){var J=this;F(".tag",J.$container).each(function(){var O=F(this),L=O.data("item"),P=J.options.itemValue(L),K=J.options.itemText(L),M=J.options.tagClass(L);if(O.attr("class",null),O.addClass("tag "+A(M)),O.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=A(K),J.isSelect){var N=F("option",J.$element).filter(function(){return F(this).data("item")===L});N.attr("value",P)}})},items:function(){return this.itemsArray},pushVal:function(){var J=this,K=F.map(J.items(),function(L){return J.options.itemValue(L).toString()});J.$element.val(K,!0).trigger("change")},build:function(L){var K=this;if(K.options=F.extend({},B,L),K.objectItems&&(K.options.freeInput=!1),E(K.options,"itemValue"),E(K.options,"itemText"),I(K.options,"tagClass"),K.options.typeahead){var J=K.options.typeahead||{};I(J,"source"),K.$input.typeahead(F.extend({},J,{source:function(P,Q){function O(V){for(var U=[],T=0;T<V.length;T++){var S=K.options.itemText(V[T]);R[S]=V[T],U.push(S)}Q(U)}this.map={};var R=this.map,N=J.source(P);F.isFunction(N.success)?N.success(O):F.isFunction(N.then)?N.then(O):F.when(N).then(O)},updater:function(N){K.add(this.map[N])},matcher:function(N){return -1!==N.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(N){return N.sort()},highlighter:function(O){var N=new RegExp("("+this.query+")","gi");return O.replace(N,"<strong>$1</strong>")}}))}if(K.options.typeaheadjs){var M=K.options.typeaheadjs||{};K.$input.typeahead(null,M).on("typeahead:selected",F.proxy(function(O,N){K.add(M.valueKey?N[M.valueKey]:N),K.$input.typeahead("val","")},K))}K.$container.on("click",F.proxy(function(){K.$element.attr("disabled")||K.$input.removeAttr("disabled"),K.$input.focus()},K)),K.options.addOnBlur&&K.options.freeInput&&K.$input.on("focusout",F.proxy(function(){0===F(".typeahead, .twitter-typeahead",K.$container).length&&(K.add(K.$input.val()),K.$input.val(""))},K)),K.$container.on("keydown","input",F.proxy(function(R){var S=F(R.target),U=K.findInputWrapper();if(K.$element.attr("disabled")){return void K.$input.attr("disabled","disabled")}switch(R.which){case 8:if(0===G(S[0])){var T=U.prev();T&&K.remove(T.data("item"))}break;case 46:if(0===G(S[0])){var P=U.next();P&&K.remove(P.data("item"))}break;case 37:var Q=U.prev();0===S.val().length&&Q[0]&&(Q.before(U),S.focus());break;case 39:var N=U.next();0===S.val().length&&N[0]&&(N.after(U),S.focus())}var O=S.val().length;Math.ceil(O/5);S.attr("size",Math.max(this.inputSize,S.val().length))},K)),K.$container.on("keypress","input",F.proxy(function(P){var Q=F(P.target);if(K.$element.attr("disabled")){return void K.$input.attr("disabled","disabled")}var O=Q.val(),R=K.options.maxChars&&O.length>=K.options.maxChars;K.options.freeInput&&(H(P,K.options.confirmKeys)||R)&&(K.add(R?O.substr(0,K.options.maxChars):O),Q.val(""),P.preventDefault());var N=Q.val().length;Math.ceil(N/5);Q.attr("size",Math.max(this.inputSize,Q.val().length))},K)),K.$container.on("click","[data-role=remove]",F.proxy(function(N){K.$element.attr("disabled")||K.remove(F(N.target).closest(".tag").data("item"))},K)),K.options.itemValue===B.itemValue&&("INPUT"===K.$element[0].tagName?K.add(K.$element.val()):F("option",K.$element).each(function(){K.add(F(this).attr("value"),!0)}))},destroy:function(){var J=this;J.$container.off("keypress","input"),J.$container.off("click","[role=remove]"),J.$container.remove(),J.$element.removeData("tagsinput"),J.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var J=this.$input[0],K=this.$container[0];J&&J.parentNode!==K;){J=J.parentNode}return F(J)}},F.fn.tagsinput=function(L,J){var K=[];return this.each(function(){var N=F(this).data("tagsinput");if(N){if(L||J){if(void 0!==N[L]){var M=N[L](J);void 0!==M&&K.push(M)}}else{K.push(N)}}else{N=new D(this,L),F(this).data("tagsinput",N),K.push(N),"SELECT"===this.tagName&&F("option",F(this)).attr("selected","selected"),F(this).val(F(this).val())}}),"string"==typeof L?K.length>1?K:K[0]:K},F.fn.tagsinput.Constructor=D;var C=F("<div />");F(function(){F("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})}(window.jQuery);